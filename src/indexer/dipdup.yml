spec_version: 1.2
package: mavryk

database:
  kind: sqlite
  path: mavryk.sqlite3

# database:
#   kind: postgres
#   host: 127.0.0.1
#   port: 5432
#   user: dipdup
#   password: ${POSTGRES_PASSWORD:-changeme}
#   database: dipdup
#   schema_name: public

# hasura:
#   url: http://hasura:8080
#   admin_secret: ${ADMIN_SECRET:-changeme}
#   allow_aggregations: False
#   camel_case: true
#   select_limit: 100

contracts:
  mvk:
    address: KT1XqeL5SyDrrLv7uz6jJZzoNtHWXR49LmkY
    typename: mvk
  doorman:
    address: KT1H6BxLD4KzavryWVg1fPQmbvATW6nVnWGA
    typename: doorman
  # farm:
  #   address: ${MVK_TOKEN_ADDRESS:-changeme}
  #   typename: farm
  # break_glass:
  #   address: ${BREAKGLASSADDRESS}
  #   typename: break_glass
  # council:
  #   address: ${COUNCILADDRESS}
  #   typename: council
  # emergency_governance:
  #   address: ${EMERGENCYGOVERNANCEADDRESS}
  #   typename: emergency_governance
  # governance:
  #   address: ${GOVERNANCE}
  #   typename: break_glass
  # vesting:
  #   address: ${VESTINGADDRESS}
  #   typename: vesting

datasources:
  tzkt:
    kind: tzkt
    url: ${TZKT_URL:-changeme}

indexes:
  # MVK Token contract indexes
  mvk:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - mvk
    handlers:
      - callback: on_mvk_origination
        pattern:
          - type: origination
            originated_contract: mvk
      - callback: on_mvk_update_operators
        pattern:
          - destination: mvk
            entrypoint: update_operators
      - callback: on_mvk_transfer
        pattern:
          - destination: mvk
            entrypoint: transfer
      - callback: on_mvk_mint
        pattern:
          - destination: mvk
            entrypoint: mint
  # Doorman contract indexes
  doorman:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - doorman
      - mvk
    handlers:
      - callback: on_doorman_origination
        pattern:
          - type: origination
            originated_contract: doorman
      - callback: on_doorman_stake
        pattern:
          - destination: doorman
            entrypoint: stake
          - source: doorman
            destination: mvk
            entrypoint: transfer
      - callback: on_doorman_unstake_complete
        pattern:
          - destination: doorman
            entrypoint: unstakeComplete
          - source: doorman
            destination: mvk
            entrypoint: transfer
      - callback: on_doorman_compound
        pattern:
          - destination: doorman
            entrypoint: compound
      - callback: on_doorman_update_min_mvk_amount
        pattern:
          - destination: doorman
            entrypoint: updateMinMvkAmount
      - callback: on_doorman_pause_all
        pattern:
          - destination: doorman
            entrypoint: pauseAll
      - callback: on_doorman_unpause_all
        pattern:
          - destination: doorman
            entrypoint: unpauseAll
      - callback: on_doorman_toggle_pause_stake
        pattern:
          - destination: doorman
            entrypoint: togglePauseStake
      - callback: on_doorman_toggle_pause_unstake
        pattern:
          - destination: doorman
            entrypoint: togglePauseUnstake
      - callback: on_doorman_toggle_pause_compound
        pattern:
          - destination: doorman
            entrypoint: togglePauseCompound
