spec_version: 1.2
package: mavryk

database:
  kind: sqlite
  path: mavryk.sqlite3

# database:
#   kind: postgres
#   host: 127.0.0.1
#   port: 5432
#   user: dipdup
#   password: ${POSTGRES_PASSWORD:-changeme}
#   database: dipdup
#   schema_name: public

# hasura:
#   url: http://hasura:8080
#   admin_secret: ${ADMIN_SECRET:-changeme}
#   allow_aggregations: False
#   camel_case: true
#   select_limit: 100

contracts:
  mvk:
    address: KT1PVfqjjLWts3HrjWzCeE6V9ESqcn4fSTcC
    typename: mvk
  doorman:
    address: KT1JUoRqoQzMpuiRtacjmV5cyp9dyAobwEPb
    typename: doorman
  farm:
    address: KT1BjioP1wz1dyiPPqiyo5tc2ePgcLRXNAmX
    typename: farm
  farm_factory:
    address: KT1JFMVVPtWoeZMEYPLzguBSaq4nQDeeaNot
    typename: farm_factory
  # break_glass:
  #   address: ${BREAKGLASSADDRESS}
  #   typename: break_glass
  # council:
  #   address: ${COUNCILADDRESS}
  #   typename: council
  # emergency_governance:
  #   address: ${EMERGENCYGOVERNANCEADDRESS}
  #   typename: emergency_governance
  # governance:
  #   address: ${GOVERNANCE}
  #   typename: break_glass
  # vesting:
  #   address: ${VESTINGADDRESS}
  #   typename: vesting

datasources:
  tzkt:
    kind: tzkt
    url: ${TZKT_URL:-changeme}

indexes:
  # MVK Token contract indexes
  mvk:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - mvk
    handlers:
      - callback: on_mvk_origination
        pattern:
          - type: origination
            originated_contract: mvk
      - callback: on_mvk_update_operators
        pattern:
          - destination: mvk
            entrypoint: update_operators
      - callback: on_mvk_transfer
        pattern:
          - destination: mvk
            entrypoint: transfer
      - callback: on_mvk_mint
        pattern:
          - destination: mvk
            entrypoint: mint
  # Doorman contract indexes
  doorman:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - doorman
      - mvk
    handlers:
      - callback: on_doorman_origination
        pattern:
          - type: origination
            originated_contract: doorman
      - callback: on_doorman_stake
        pattern:
          - destination: doorman
            entrypoint: stake
          - source: doorman
            destination: mvk
            entrypoint: transfer
      - callback: on_doorman_unstake_complete
        pattern:
          - destination: doorman
            entrypoint: unstakeComplete
          - source: doorman
            destination: mvk
            entrypoint: transfer
      - callback: on_doorman_compound
        pattern:
          - destination: doorman
            entrypoint: compound
      - callback: on_doorman_update_min_mvk_amount
        pattern:
          - destination: doorman
            entrypoint: updateMinMvkAmount
      - callback: on_doorman_farm_claim_complete
        pattern:
          - destination: doorman
            entrypoint: farmClaimComplete
      - callback: on_doorman_pause_all
        pattern:
          - destination: doorman
            entrypoint: pauseAll
      - callback: on_doorman_unpause_all
        pattern:
          - destination: doorman
            entrypoint: unpauseAll
      - callback: on_doorman_toggle_pause_stake
        pattern:
          - destination: doorman
            entrypoint: togglePauseStake
      - callback: on_doorman_toggle_pause_unstake
        pattern:
          - destination: doorman
            entrypoint: togglePauseUnstake
      - callback: on_doorman_toggle_pause_compound
        pattern:
          - destination: doorman
            entrypoint: togglePauseCompound
  # Farm contract indexes
  farm:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - farm
    handlers:
      - callback: on_farm_origination
        pattern:
          - type: origination
            originated_contract: farm
      - callback: on_farm_init_farm
        pattern:
          - destination: farm
            entrypoint: initFarm
      - callback: on_farm_deposit
        pattern:
          - destination: farm
            entrypoint: deposit
      - callback: on_farm_withdraw
        pattern:
          - destination: farm
            entrypoint: withdraw
      - callback: on_farm_claim
        pattern:
          - destination: farm
            entrypoint: claim
      - callback: on_farm_close_farm
        pattern:
          - destination: farm
            entrypoint: closeFarm
      - callback: on_farm_increase_reward_per_block
        pattern:
          - destination: farm
            entrypoint: increaseRewardPerBlock
      - callback: on_farm_toggle_force_reward_from_transfer
        pattern:
          - destination: farm
            entrypoint: toggleForceRewardFromTransfer
      - callback: on_farm_pause_all
        pattern:
          - destination: farm
            entrypoint: pauseAll
      - callback: on_farm_unpause_all
        pattern:
          - destination: farm
            entrypoint: unpauseAll
      - callback: on_farm_toggle_pause_deposit
        pattern:
          - destination: farm
            entrypoint: togglePauseDeposit
      - callback: on_farm_toggle_pause_withdraw
        pattern:
          - destination: farm
            entrypoint: togglePauseWithdraw
      - callback: on_farm_toggle_pause_claim
        pattern:
          - destination: farm
            entrypoint: togglePauseClaim
  # Farm Factory contract indexes
  farm_factory:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - farm_factory
    handlers:
      - callback: on_farm_factory_origination
        pattern:
          - type: origination
            originated_contract: farm_factory
      - callback: on_farm_factory_create_farm
        pattern:
          - destination: farm_factory
            entrypoint: createFarm
      - callback: on_farm_factory_track_farm
        pattern:
          - destination: farm_factory
            entrypoint: trackFarm
      - callback: on_farm_factory_untrack_farm
        pattern:
          - destination: farm_factory
            entrypoint: untrackFarm
      - callback: on_farm_factory_pause_all
        pattern:
          - destination: farm_factory
            entrypoint: pauseAll
      - callback: on_farm_factory_unpause_all
        pattern:
          - destination: farm_factory
            entrypoint: unpauseAll
      - callback: on_farm_factory_toggle_pause_create_farm
        pattern:
          - destination: farm_factory
            entrypoint: togglePauseCreateFarm
      - callback: on_farm_factory_toggle_pause_track_farm
        pattern:
          - destination: farm_factory
            entrypoint: togglePauseTrackFarm
      - callback: on_farm_factory_toggle_pause_untrack_farm
        pattern:
          - destination: farm_factory
            entrypoint: togglePauseUntrackFarm
