spec_version: 1.2
package: mavryk

database:
  kind: sqlite
  path: mavryk.sqlite3

# database:
#   kind: postgres
#   host: 127.0.0.1
#   port: 5432
#   user: dipdup
#   password: ${POSTGRES_PASSWORD:-changeme}
#   database: dipdup
#   schema_name: public

# hasura:
#   url: http://hasura:8080
#   admin_secret: ${ADMIN_SECRET:-changeme}
#   allow_aggregations: False
#   camel_case: true
#   select_limit: 100

contracts:
  mvk:
    address: KT1CfB2hLU6oZpnFsuSw77aLanDEFPJjJtmW
    typename: mvk
  doorman:
    address: KT1NYRHupHBMDLdChrweYuKfuFTJttbWP3ua
    typename: doorman
  farm:
    address: KT1CazyJDLTCAYp4UXzzGFtN382V5NtAofBL
    typename: farm
  farm_factory:
    address: KT1TDe5Jh18wiNkoKW223L6oFvd4LV88u8yi
    typename: farm_factory
  delegation:
    address: KT1Nv9w4tShibfmyQc9hrZzwVnWZUJAgNYYn
    typename: delegation

datasources:
  tzkt:
    kind: tzkt
    url: ${TZKT_URL:-changeme}

templates:
  farm_template:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - <farm_contract>
    handlers:
      - callback: on_farm_origination
        pattern:
          - type: origination
            originated_contract: <farm_contract>
      - callback: on_farm_init_farm
        pattern:
          - destination: <farm_contract>
            entrypoint: initFarm
      - callback: on_farm_deposit
        pattern:
          - destination: <farm_contract>
            entrypoint: deposit
      - callback: on_farm_withdraw
        pattern:
          - destination: <farm_contract>
            entrypoint: withdraw
      - callback: on_farm_claim
        pattern:
          - destination: <farm_contract>
            entrypoint: claim
      - callback: on_farm_close_farm
        pattern:
          - destination: <farm_contract>
            entrypoint: closeFarm
      - callback: on_farm_increase_reward_per_block
        pattern:
          - destination: <farm_contract>
            entrypoint: increaseRewardPerBlock
      - callback: on_farm_toggle_force_reward_from_transfer
        pattern:
          - destination: <farm_contract>
            entrypoint: toggleForceRewardFromTransfer
      - callback: on_farm_pause_all
        pattern:
          - destination: <farm_contract>
            entrypoint: pauseAll
      - callback: on_farm_unpause_all
        pattern:
          - destination: <farm_contract>
            entrypoint: unpauseAll
      - callback: on_farm_toggle_pause_deposit
        pattern:
          - destination: <farm_contract>
            entrypoint: togglePauseDeposit
      - callback: on_farm_toggle_pause_withdraw
        pattern:
          - destination: <farm_contract>
            entrypoint: togglePauseWithdraw
      - callback: on_farm_toggle_pause_claim
        pattern:
          - destination: <farm_contract>
            entrypoint: togglePauseClaim

indexes:
  # MVK Token contract indexes
  mvk:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - mvk
    handlers:
      - callback: on_mvk_origination
        pattern:
          - type: origination
            originated_contract: mvk
      - callback: on_mvk_update_operators
        pattern:
          - destination: mvk
            entrypoint: update_operators
      - callback: on_mvk_transfer
        pattern:
          - destination: mvk
            entrypoint: transfer
      - callback: on_mvk_mint
        pattern:
          - destination: mvk
            entrypoint: mint
  # Doorman contract indexes
  doorman:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - doorman
      - mvk
    handlers:
      - callback: on_doorman_origination
        pattern:
          - type: origination
            originated_contract: doorman
      - callback: on_doorman_stake
        pattern:
          - destination: doorman
            entrypoint: stake
          - source: doorman
            destination: mvk
            entrypoint: transfer
      - callback: on_doorman_unstake_complete
        pattern:
          - destination: doorman
            entrypoint: unstakeComplete
          - source: doorman
            destination: mvk
            entrypoint: transfer
      - callback: on_doorman_compound
        pattern:
          - destination: doorman
            entrypoint: compound
      - callback: on_doorman_farm_claim_complete
        pattern:
          - destination: doorman
            entrypoint: farmClaimComplete
      - callback: on_doorman_update_min_mvk_amount
        pattern:
          - destination: doorman
            entrypoint: updateMinMvkAmount
      - callback: on_doorman_farm_claim_complete
        pattern:
          - destination: doorman
            entrypoint: farmClaimComplete
      - callback: on_doorman_pause_all
        pattern:
          - destination: doorman
            entrypoint: pauseAll
      - callback: on_doorman_unpause_all
        pattern:
          - destination: doorman
            entrypoint: unpauseAll
      - callback: on_doorman_toggle_pause_stake
        pattern:
          - destination: doorman
            entrypoint: togglePauseStake
      - callback: on_doorman_toggle_pause_unstake
        pattern:
          - destination: doorman
            entrypoint: togglePauseUnstake
      - callback: on_doorman_toggle_pause_compound
        pattern:
          - destination: doorman
            entrypoint: togglePauseCompound
  # Farm contract indexes
  farm:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - farm
    handlers:
      - callback: on_farm_origination
        pattern:
          - type: origination
            originated_contract: farm
      - callback: on_farm_init_farm
        pattern:
          - destination: farm
            entrypoint: initFarm
      - callback: on_farm_deposit
        pattern:
          - destination: farm
            entrypoint: deposit
      - callback: on_farm_withdraw
        pattern:
          - destination: farm
            entrypoint: withdraw
      - callback: on_farm_claim
        pattern:
          - destination: farm
            entrypoint: claim
      - callback: on_farm_close_farm
        pattern:
          - destination: farm
            entrypoint: closeFarm
      - callback: on_farm_increase_reward_per_block
        pattern:
          - destination: farm
            entrypoint: increaseRewardPerBlock
      - callback: on_farm_toggle_force_reward_from_transfer
        pattern:
          - destination: farm
            entrypoint: toggleForceRewardFromTransfer
      - callback: on_farm_pause_all
        pattern:
          - destination: farm
            entrypoint: pauseAll
      - callback: on_farm_unpause_all
        pattern:
          - destination: farm
            entrypoint: unpauseAll
      - callback: on_farm_toggle_pause_deposit
        pattern:
          - destination: farm
            entrypoint: togglePauseDeposit
      - callback: on_farm_toggle_pause_withdraw
        pattern:
          - destination: farm
            entrypoint: togglePauseWithdraw
      - callback: on_farm_toggle_pause_claim
        pattern:
          - destination: farm
            entrypoint: togglePauseClaim
  # Farm Factory contract indexes
  farm_factory:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - farm_factory
    handlers:
      - callback: on_farm_factory_origination
        pattern:
          - type: origination
            originated_contract: farm_factory
      - callback: on_farm_factory_create_farm
        pattern:
          - destination: farm_factory
            entrypoint: createFarm
      - callback: on_farm_factory_track_farm
        pattern:
          - destination: farm_factory
            entrypoint: trackFarm
      - callback: on_farm_factory_pause_all
        pattern:
          - destination: farm_factory
            entrypoint: pauseAll
      - callback: on_farm_factory_unpause_all
        pattern:
          - destination: farm_factory
            entrypoint: unpauseAll
      - callback: on_farm_factory_toggle_pause_create_farm
        pattern:
          - destination: farm_factory
            entrypoint: togglePauseCreateFarm
      - callback: on_farm_factory_toggle_pause_track_farm
        pattern:
          - destination: farm_factory
            entrypoint: togglePauseTrackFarm
      - callback: on_farm_factory_toggle_pause_untrack_farm
        pattern:
          - destination: farm_factory
            entrypoint: togglePauseUntrackFarm
  # Delegation contract indexes
  delegation:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - delegation
    handlers:
      - callback: on_delegation_origination
        pattern:
          - type: origination
            originated_contract: delegation
      - callback: on_delegation_update_config
        pattern:
          - destination: delegation
            entrypoint: updateConfig
      - callback: on_delegation_delegate_to_satellite
        pattern:
          - destination: delegation
            entrypoint: delegateToSatellite
      - callback: on_delegation_undelegate_from_satellite
        pattern:
          - destination: delegation
            entrypoint: undelegateFromSatelliteComplete
      - callback: on_delegation_register_as_satellite_complete
        pattern:
          - destination: delegation
            entrypoint: registerAsSatelliteComplete
      - callback: on_delegation_unregister_as_satellite
        pattern:
          - destination: delegation
            entrypoint: unregisterAsSatellite
      - callback: on_delegation_update_satellite_record
        pattern:
          - destination: delegation
            entrypoint: updateSatelliteRecord
      - callback: on_delegation_toggle_pause_delegate_to_satellite
        pattern:
          - destination: delegation
            entrypoint: togglePauseDelegateToSatellite
      - callback: on_delegation_toggle_pause_undelegate_satellite
        pattern:
          - destination: delegation
            entrypoint: togglePauseUndelegateSatellite
      - callback: on_delegation_toggle_pause_register_satellite
        pattern:
          - destination: delegation
            entrypoint: togglePauseRegisterSatellite
      - callback: on_delegation_toggle_pause_unregister_satellite
        pattern:
          - destination: delegation
            entrypoint: togglePauseUnregisterSatellite
      - callback: on_delegation_toggle_pause_update_satellite
        pattern:
          - destination: delegation
            entrypoint: togglePauseDelegateToSatellite
      - callback: on_delegation_pause_all
        pattern:
          - destination: delegation
            entrypoint: pauseAll
      - callback: on_delegation_unpause_all
        pattern:
          - destination: delegation
            entrypoint: unpauseAll
