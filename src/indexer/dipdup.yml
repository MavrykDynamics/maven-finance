spec_version: 1.2
package: mavryk

# database:
#   kind: sqlite
#   path: mavryk.sqlite3

database:
  kind: postgres
  host: '127.0.0.1'
  port: '5432'
  user: dipdup
  password: dipdup12345
  database: dipdup
  schema_name: public

hasura:
  url: http://127.0.0.1:42000
  admin_secret: ${ADMIN_SECRET:-changeme}
  select_limit: 1000

contracts:
  mvk:
    address: KT1CfB2hLU6oZpnFsuSw77aLanDEFPJjJtmW
    typename: mvk
  doorman:
    address: KT1NYRHupHBMDLdChrweYuKfuFTJttbWP3ua
    typename: doorman
  farm:
    address: KT1CazyJDLTCAYp4UXzzGFtN382V5NtAofBL
    typename: farm
  farm_factory:
    address: KT1TDe5Jh18wiNkoKW223L6oFvd4LV88u8yi
    typename: farm_factory
  delegation:
    address: KT1Nv9w4tShibfmyQc9hrZzwVnWZUJAgNYYn
    typename: delegation
  vesting:
    address: KT1Hzo5zQGSg18V1mPJ6umt7fmJq54MAF2ks
    typename: vesting
  emergency_governance:
    address: KT1SeJkZ8ML8pHRHMMYhHqgtet6N3b5Snq7c
    typename: emergency_governance
  council:
    address: KT1E47MwvFfSoc4CTg8PwYpN2SS6N8rdjikN
    typename: council
  break_glass:
    address: KT1J1jQ1vjYh6ke8sRjp4MMrN3S7LL72bZ8o
    typename: break_glass
  governance:
    address: KT1CyWegk8p93JDy8w2jrG77B8qiQSV8RaeQ
    typename: governance

datasources:
  tzkt:
    kind: tzkt
    url: ${TZKT_URL:-changeme}

templates:
  farm_template:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - <farm_contract>
    handlers:
      - callback: on_farm_origination
        pattern:
          - type: origination
            originated_contract: <farm_contract>
      - callback: on_farm_init_farm
        pattern:
          - destination: <farm_contract>
            entrypoint: initFarm
      - callback: on_farm_deposit
        pattern:
          - destination: <farm_contract>
            entrypoint: deposit
      - callback: on_farm_withdraw
        pattern:
          - destination: <farm_contract>
            entrypoint: withdraw
      - callback: on_farm_claim
        pattern:
          - destination: <farm_contract>
            entrypoint: claim
      - callback: on_farm_close_farm
        pattern:
          - destination: <farm_contract>
            entrypoint: closeFarm
      - callback: on_farm_increase_reward_per_block
        pattern:
          - destination: <farm_contract>
            entrypoint: increaseRewardPerBlock
      - callback: on_farm_toggle_force_reward_from_transfer
        pattern:
          - destination: <farm_contract>
            entrypoint: toggleForceRewardFromTransfer
      - callback: on_farm_pause_all
        pattern:
          - destination: <farm_contract>
            entrypoint: pauseAll
      - callback: on_farm_unpause_all
        pattern:
          - destination: <farm_contract>
            entrypoint: unpauseAll
      - callback: on_farm_toggle_pause_deposit
        pattern:
          - destination: <farm_contract>
            entrypoint: togglePauseDeposit
      - callback: on_farm_toggle_pause_withdraw
        pattern:
          - destination: <farm_contract>
            entrypoint: togglePauseWithdraw
      - callback: on_farm_toggle_pause_claim
        pattern:
          - destination: <farm_contract>
            entrypoint: togglePauseClaim

indexes:
  # MVK Token contract indexes
  mvk:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - mvk
    handlers:
      - callback: on_mvk_origination
        pattern:
          - type: origination
            originated_contract: mvk
      - callback: on_mvk_transfer
        pattern:
          - destination: mvk
            entrypoint: transfer
      - callback: on_mvk_mint
        pattern:
          - destination: mvk
            entrypoint: mint
      - callback: on_mvk_update_operators
        pattern:
          - destination: mvk
            entrypoint: update_operators
  # Doorman contract indexes
  doorman:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - doorman
      - mvk
    handlers:
      - callback: on_doorman_origination
        pattern:
          - type: origination
            originated_contract: doorman
      - callback: on_doorman_stake
        pattern:
          - destination: doorman
            entrypoint: stake
          - source: doorman
            destination: mvk
            entrypoint: transfer
      - callback: on_doorman_unstake_complete
        pattern:
          - destination: doorman
            entrypoint: unstakeComplete
          - source: doorman
            destination: mvk
            entrypoint: transfer
      - callback: on_doorman_compound
        pattern:
          - destination: doorman
            entrypoint: compound
      - callback: on_doorman_farm_claim_complete
        pattern:
          - destination: doorman
            entrypoint: farmClaimComplete
      - callback: on_doorman_update_min_mvk_amount
        pattern:
          - destination: doorman
            entrypoint: updateMinMvkAmount
      - callback: on_doorman_farm_claim_complete
        pattern:
          - destination: doorman
            entrypoint: farmClaimComplete
      - callback: on_doorman_pause_all
        pattern:
          - destination: doorman
            entrypoint: pauseAll
      - callback: on_doorman_unpause_all
        pattern:
          - destination: doorman
            entrypoint: unpauseAll
      - callback: on_doorman_toggle_pause_stake
        pattern:
          - destination: doorman
            entrypoint: togglePauseStake
      - callback: on_doorman_toggle_pause_unstake
        pattern:
          - destination: doorman
            entrypoint: togglePauseUnstake
      - callback: on_doorman_toggle_pause_compound
        pattern:
          - destination: doorman
            entrypoint: togglePauseCompound
  # Farm contract indexes
  farm:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - farm
    handlers:
      - callback: on_farm_origination
        pattern:
          - type: origination
            originated_contract: farm
      - callback: on_farm_init_farm
        pattern:
          - destination: farm
            entrypoint: initFarm
      - callback: on_farm_deposit
        pattern:
          - destination: farm
            entrypoint: deposit
      - callback: on_farm_withdraw
        pattern:
          - destination: farm
            entrypoint: withdraw
      - callback: on_farm_claim
        pattern:
          - destination: farm
            entrypoint: claim
      - callback: on_farm_close_farm
        pattern:
          - destination: farm
            entrypoint: closeFarm
      - callback: on_farm_increase_reward_per_block
        pattern:
          - destination: farm
            entrypoint: increaseRewardPerBlock
      - callback: on_farm_toggle_force_reward_from_transfer
        pattern:
          - destination: farm
            entrypoint: toggleForceRewardFromTransfer
      - callback: on_farm_pause_all
        pattern:
          - destination: farm
            entrypoint: pauseAll
      - callback: on_farm_unpause_all
        pattern:
          - destination: farm
            entrypoint: unpauseAll
      - callback: on_farm_toggle_pause_deposit
        pattern:
          - destination: farm
            entrypoint: togglePauseDeposit
      - callback: on_farm_toggle_pause_withdraw
        pattern:
          - destination: farm
            entrypoint: togglePauseWithdraw
      - callback: on_farm_toggle_pause_claim
        pattern:
          - destination: farm
            entrypoint: togglePauseClaim
  # Farm Factory contract indexes
  farm_factory:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - farm_factory
    handlers:
      - callback: on_farm_factory_origination
        pattern:
          - type: origination
            originated_contract: farm_factory
      - callback: on_farm_factory_create_farm
        pattern:
          - destination: farm_factory
            entrypoint: createFarm
      - callback: on_farm_factory_track_farm
        pattern:
          - destination: farm_factory
            entrypoint: trackFarm
      - callback: on_farm_factory_pause_all
        pattern:
          - destination: farm_factory
            entrypoint: pauseAll
      - callback: on_farm_factory_unpause_all
        pattern:
          - destination: farm_factory
            entrypoint: unpauseAll
      - callback: on_farm_factory_toggle_pause_create_farm
        pattern:
          - destination: farm_factory
            entrypoint: togglePauseCreateFarm
      - callback: on_farm_factory_toggle_pause_track_farm
        pattern:
          - destination: farm_factory
            entrypoint: togglePauseTrackFarm
      - callback: on_farm_factory_toggle_pause_untrack_farm
        pattern:
          - destination: farm_factory
            entrypoint: togglePauseUntrackFarm
  # Delegation contract indexes
  delegation:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - delegation
    handlers:
      - callback: on_delegation_origination
        pattern:
          - type: origination
            originated_contract: delegation
      - callback: on_delegation_update_config
        pattern:
          - destination: delegation
            entrypoint: updateConfig
      - callback: on_delegation_delegate_to_satellite
        pattern:
          - destination: delegation
            entrypoint: delegateToSatellite
      - callback: on_delegation_undelegate_from_satellite
        pattern:
          - destination: delegation
            entrypoint: undelegateFromSatelliteComplete
      - callback: on_delegation_register_as_satellite_complete
        pattern:
          - destination: delegation
            entrypoint: registerAsSatelliteComplete
      - callback: on_delegation_unregister_as_satellite
        pattern:
          - destination: delegation
            entrypoint: unregisterAsSatellite
      - callback: on_delegation_update_satellite_record
        pattern:
          - destination: delegation
            entrypoint: updateSatelliteRecord
      - callback: on_delegation_toggle_pause_delegate_to_satellite
        pattern:
          - destination: delegation
            entrypoint: togglePauseDelegateToSatellite
      - callback: on_delegation_toggle_pause_undelegate_satellite
        pattern:
          - destination: delegation
            entrypoint: togglePauseUndelegateSatellite
      - callback: on_delegation_toggle_pause_register_satellite
        pattern:
          - destination: delegation
            entrypoint: togglePauseRegisterSatellite
      - callback: on_delegation_toggle_pause_unregister_satellite
        pattern:
          - destination: delegation
            entrypoint: togglePauseUnregisterSatellite
      - callback: on_delegation_toggle_pause_update_satellite
        pattern:
          - destination: delegation
            entrypoint: togglePauseDelegateToSatellite
      - callback: on_delegation_pause_all
        pattern:
          - destination: delegation
            entrypoint: pauseAll
      - callback: on_delegation_unpause_all
        pattern:
          - destination: delegation
            entrypoint: unpauseAll
  # Vesting contract indexes
  vesting:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - vesting
    handlers:
      - callback: on_vesting_origination
        pattern:
          - type: origination
            originated_contract: vesting
      - callback: on_vesting_update_config
        pattern:
          - destination: vesting
            entrypoint: updateConfig
      - callback: on_vesting_add_vestee
        pattern:
          - destination: vesting
            entrypoint: addVestee
      - callback: on_vesting_remove_vestee
        pattern:
          - destination: vesting
            entrypoint: removeVestee
      - callback: on_vesting_claim
        pattern:
          - destination: vesting
            entrypoint: claim
      - callback: on_vesting_toggle_vestee_lock
        pattern:
          - destination: vesting
            entrypoint: toggleVesteeLock
      - callback: on_vesting_update_vestee
        pattern:
          - destination: vesting
            entrypoint: updateVestee
  # Emergency Governance contract indexes
  emergency_governance:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - emergency_governance
    handlers:
      - callback: on_emergency_governance_origination
        pattern:
          - type: origination
            originated_contract: emergency_governance
      - callback: on_emergency_governance_update_config
        pattern:
          - destination: emergency_governance
            entrypoint: updateConfig
      - callback: on_emergency_governance_trigger_emergency_control
        pattern:
          - destination: emergency_governance
            entrypoint: triggerEmergencyControl
      - callback: on_emergency_governance_drop_emergency_governance
        pattern:
          - destination: emergency_governance
            entrypoint: dropEmergencyGovernance
      - callback: on_emergency_governance_vote_for_emergency_control
        pattern:
          - destination: emergency_governance
            entrypoint: voteForEmergencyControl
          - destination: emergency_governance
            entrypoint: voteForEmergencyControlComplete
  # Council contract indexes
  council:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - council
    handlers:
      - callback: on_council_origination
        pattern:
          - type: origination
            originated_contract: council
      - callback: on_council_update_config
        pattern:
          - destination: council
            entrypoint: updateConfig
      - callback: on_council_council_action_add_member
        pattern:
          - destination: council
            entrypoint: councilActionAddMember
      - callback: on_council_council_action_add_vestee
        pattern:
          - destination: council
            entrypoint: councilActionAddVestee
      - callback: on_council_council_action_change_member
        pattern:
          - destination: council
            entrypoint: councilActionChangeMember
      - callback: on_council_council_action_remove_member
        pattern:
          - destination: council
            entrypoint: councilActionRemoveMember
      - callback: on_council_council_action_remove_vestee
        pattern:
          - destination: council
            entrypoint: councilActionRemoveVestee
      - callback: on_council_council_action_request_mint
        pattern:
          - destination: council
            entrypoint: councilActionRequestMint
      - callback: on_council_council_action_request_tokens
        pattern:
          - destination: council
            entrypoint: councilActionRequestTokens
      - callback: on_council_council_action_toggle_vestee_lock
        pattern:
          - destination: council
            entrypoint: councilActionToggleVesteeLock
      - callback: on_council_council_action_transfer
        pattern:
          - destination: council
            entrypoint: councilActionTransfer
      - callback: on_council_council_action_update_vestee
        pattern:
          - destination: council
            entrypoint: councilActionUpdateVestee
      - callback: on_council_flush_action
        pattern:
          - destination: council
            entrypoint: flushAction
      - callback: on_council_sign_action
        pattern:
          - destination: council
            entrypoint: signAction
  # Break Glass contract indexes
  break_glass:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - break_glass
    handlers:
      - callback: on_break_glass_origination
        pattern:
          - type: origination
            originated_contract: break_glass
      - callback: on_break_glass_update_config
        pattern:
          - destination: break_glass
            entrypoint: updateConfig
      - callback: on_break_glass_add_council_member
        pattern:
          - destination: break_glass
            entrypoint: addCouncilMember
      - callback: on_break_glass_change_council_member
        pattern:
          - destination: break_glass
            entrypoint: changeCouncilMember
      - callback: on_break_glass_flush_action
        pattern:
          - destination: break_glass
            entrypoint: flushAction
      - callback: on_break_glass_pause_all_entrypoints
        pattern:
          - destination: break_glass
            entrypoint: pauseAllEntrypoints
      - callback: on_break_glass_unpause_all_entrypoints
        pattern:
          - destination: break_glass
            entrypoint: unpauseAllEntrypoints
      - callback: on_break_glass_remove_break_glass_control
        pattern:
          - destination: break_glass
            entrypoint: removeBreakGlassControl
      - callback: on_break_glass_remove_council_member
        pattern:
          - destination: break_glass
            entrypoint: removeCouncilMember
      - callback: on_break_glass_remove_council_member
        pattern:
          - destination: break_glass
            entrypoint: removeCouncilMember
      - callback: on_break_glass_set_all_contracts_admin
        pattern:
          - destination: break_glass
            entrypoint: setAllContractsAdmin
      - callback: on_break_glass_set_all_contracts_admin
        pattern:
          - destination: break_glass
            entrypoint: setAllContractsAdmin
      - callback: on_break_glass_set_single_contract_admin
        pattern:
          - destination: break_glass
            entrypoint: setSingleContractAdmin
      - callback: on_break_glass_break_glass
        pattern:
          - destination: break_glass
            entrypoint: breakGlass
      - callback: on_break_glass_sign_action
        pattern:
          - destination: break_glass
            entrypoint: signAction
  # Governance contract indexes
  governance:
    kind: operation
    datasource: tzkt
    types:
      - origination
      - transaction
    contracts:
      - governance
    handlers:
      - callback: on_governance_origination
        pattern:
          - type: origination
            originated_contract: governance
      - callback: on_governance_update_config
        pattern:
          - destination: governance
            entrypoint: updateConfig
      - callback: on_governance_start_proposal_round
        pattern:
          - destination: governance
            entrypoint: startProposalRound
      - callback: on_governance_propose
        pattern:
          - destination: governance
            entrypoint: propose
      - callback: on_governance_add_update_proposal_data
        pattern:
          - destination: governance
            entrypoint: addUpdateProposalData
